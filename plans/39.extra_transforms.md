Harmonisation/voice-leading
-> extract chord symbol from annotation
-> convert/replace chord symbol to chord (and its chord notes)
-> voice lead chords amongst each other

system selectors?
consolidate rests in bars -> do we already have this in the code base, as one of the AST visitors?
special «paste» chord over (melody) note -> merge note in chord.
  - we could have special rules, suchas «drop octaves of chord notes such that the melody note remains the top note of the chord».

Some workflow ideas:
-> harmonize cursored note based on prev chord symbol in system.


-> selector: select notes that are chord tones of prev chord symbol. 
  The algo is: 
    - I have a selection cursor with a target note, 
    - the algo searches for an annotation that contains a chord symbol amongst the expressions on the same line prior to the note, 
    - if found, extract chord symbol from annotation, convert symbol to chord (and its notes),
    - compare target note with chord notes: if it’s one of them, select note
  This allows workflows with:
    - modify (octaviate) rest of chord notes (if necessary) such that they’re below the target note, and paste them.

-> harmonize parallely to previous chord:
  algo is:
    - I have a selection cursor with a target note
    - algo backtracks in line searching for a chord. 
    - if found, transpose diatonically such that the target note becomes the top note of the new chord, and paste the rest of the chord notes.


-> harmonize note in parallel third/fourth/fifth/sixth, diatonically.
-> paste rhythm sequence to pitches. 
  This requires a time map, the happy path being: on a long note that’s selected, paste the rhythms of the sequence of notes that’s in the clipboard (or in a modal editor’s register).
-> wrap selection in crescendo, descrescendo, swell, unswell.
-> match notes based on rhythms/patterns

-> setup midi input (already done in vscode)
-> allow folds for tune section, tunes, instrument sections.

---


Doable without music theory:
- Paste rhythm sequence to pitches (rhythm manipulation): 4

Needs music-theory module (chord parsing):

- Extract chord symbol from annotation: 2
- Convert chord symbol to chord notes: 2 
- Voice lead chords : 4
- Select notes that are chord tones of prev chord symbol: 4
- Harmonize note based on prev chord symbol: 4
- Harmonize parallely to previous chord: 4
- Paste chord over melody note: 5

---
In abc_parse, in plan 39, I have a request to implement an abct2 selector that would allow me to select notes or chords or rests that carry a rhythm expression.

The select must be integrated into the language server as a custom command.

Look at previous selector implementations and explore the codebase to understand how this works.

Your task is to create the implementation plan. Make sure to follow the planning protocol outlined in CLAUDE.md. You must add the plan as a new plan file in the plans directory, do not go into plan mode for this.

Instead of showing me the whole plan to approach, show me one phase at a time for me to read and give feedback, and only when I approve that phase will you write it to the plan file and show me the next phase.


You may ask me any needed clarifications about the plan.

